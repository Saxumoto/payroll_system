{% extends 'base.html' %}

{% block title %}Employee List - Payroll System{% endblock %}
{% block page_title %}Employee List{% endblock %}

{% block content %}

<div class="card">
<div class="card-header">
<div class="card-header-content">
<h3>All Employees ({{ total_employees }})</h3>
<a href="{{ url_for('export_payroll_csv') }}" class="btn btn-action btn-blue">
<i class="bi bi-download me-1"></i> Generate Report
</a>
</div>
</div>

<div class="table-wrapper">
    <table class="table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Position</th>
                <th>Department</th>
                <th>Salary</th>
                <th>Tax</th>
                <th>Net Pay</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for employee in employees %}
            <tr>
                <td>{{ employee.id }}</td>
                <td class="table-profile">
                    <img src="{{ url_for('static', filename='uploads/' + (employee.photo if employee.photo else 'default.png')) }}" 
                         alt="{{ employee.name }}"
                         onerror="this.src='{{ url_for('static', filename='uploads/default.png') }}';">
                    <span>{{ employee.name }}</span>
                </td>
                <td>{{ employee.position }}</td>
                <td>{{ employee.department }}</td>
                <td>₱{{ "%.2f"|format(employee.salary) }}</td>
                <td>₱{{ "%.2f"|format(employee.tax) }}</td>
                <td>₱{{ "%.2f"|format(employee.net_salary) }}</td>
                <td class="actions">
                    <a href="{{ url_for('view_payroll', emp_id=employee.id) }}" class="btn btn-sm btn-info" title="View Payslip">
                        <i class="bi bi-eye-fill"></i>
                    </a>
                    {% if current_user.is_admin %}
                    <a href="{{ url_for('edit_employee', employee_id=employee.id) }}" class="btn btn-sm btn-warning" title="Edit">
                        <i class="bi bi-pencil-fill"></i>
                    </a>
                    <a href="{{ url_for('manage_loans', emp_id=employee.id) }}" class="btn btn-sm btn-success" title="Manage Loans">
                        <i class="bi bi-cash-coin"></i>
                    </a>
                    <a href="{{ url_for('manage_attendance', emp_id=employee.id) }}" class="btn btn-sm btn-dark" title="Manage Attendance" style="background-color: #343a40; color: white;">
                        <i class="bi bi-clock-fill"></i>
                    </a>
                    <form action="{{ url_for('delete_employee_route', emp_id=employee.id) }}" method="POST" class="d-inline" onsubmit="return confirm('Are you sure you want to archive this employee?');">
                        <button type="submit" class="btn btn-sm btn-danger" title="Delete">
                            <i class="bi bi-trash-fill"></i>
                        </button>
                    </form>
                    {% endif %}
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="8" style="text-align: center; padding: 1.5rem;">No employees found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="table-summary">
    <div class="summary-item">
        <strong>Total Salary:</strong> ₱{{ total_salary }}
    </div>
    <div class="summary-item">
        <strong>Total SSS:</strong> ₱{{ total_sss }}
    </div>
    <div class="summary-item">
        <strong>Total PhilHealth:</strong> ₱{{ total_philhealth }}
    </div>
    <div class="summary-item">
        <strong>Total Pag-IBIG:</strong> ₱{{ total_pagibig }}
    </div>
    <div class="summary-item">
        <strong>Total Tax:</strong> ₱{{ total_tax }}
    </div>
    <div class="summary-item">
        <strong>Total Net Pay:</strong> ₱{{ net_total }}
    </div>
</div>


</div>
{% endblock %}